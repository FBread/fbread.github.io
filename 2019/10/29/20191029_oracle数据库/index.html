<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>oracle数据库 | 面包土豆西红柿</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="oracle数据库">
<meta property="og:type" content="article">
<meta property="og:title" content="oracle数据库">
<meta property="og:url" content="https://fbread.github.io/2019/10/29/20191029_oracle%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">
<meta property="og:site_name" content="面包土豆西红柿">
<meta property="og:description" content="oracle数据库">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1572319243175.png">
<meta property="article:published_time" content="2019-10-28T16:00:36.000Z">
<meta property="article:modified_time" content="2024-05-30T06:34:38.582Z">
<meta property="article:author" content="Ziyi Jiang">
<meta property="article:tag" content="Oracle">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1572319243175.png">
  
    <link rel="alternate" href="/atom.xml" title="面包土豆西红柿" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">面包土豆西红柿</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://fbread.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-20191029_oracle数据库" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/10/29/20191029_oracle%E6%95%B0%E6%8D%AE%E5%BA%93/" class="article-date">
  <time class="dt-published" datetime="2019-10-28T16:00:36.000Z" itemprop="datePublished">2019-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      oracle数据库
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Oracle ORCL VSS Writer Service 可以禁用</p>
<p>Listener 和OracleServiceORCL改为手动</p>
<ul>
<li>登录oracle:<ul>
<li>用户名:sys</li>
<li>密码:root</li>
<li>database:orcl</li>
</ul>
</li>
</ul>
<!-- -->

<ul>
<li><p>oracle 数据库:一个大的磁盘空间</p>
<p>在大的磁盘空间中去创建表空间,对应着文件,有名字,对应着一个用户</p>
<p>sys&#x2F;stytem 管理员</p>
<p>在创建数据库的同时,默认创建了system表空间,存放系统用户的信息.</p>
<p>​ oracle创建了实例用户, 用户名:scott<br>密码:tiger,默认是锁定的.需要用sys帐户登录后,找到<code>user</code>表,-&gt;scott-&gt;右键edit-&gt;general-&gt;Account<br>locked勾掉,上面Role privileges选项卡,把Grantable下的两个都勾上.</p>
<p>再次登录,身份是normal</p>
</li>
</ul>
<h3 id="sys-和system用户"><a href="#sys-和system用户" class="headerlink" title="sys 和system用户"></a>sys 和system用户</h3><p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1572319243175.png" alt="1572319243175"></p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><ul>
<li>varchar2(size) 变长字符串</li>
<li>char(size) 固定长度字符串</li>
<li>number(p,s) 变长数值</li>
<li>date 日期和时间值</li>
<li>long 可存放最多2GB的变长字符数据</li>
<li>clob 可存放最多4GB的变长数据</li>
<li>RAW and long RAW 二进制数据</li>
<li>BLOB 可存放最多4GB二进制数据</li>
</ul>
<h2 id="数据操作"><a href="#数据操作" class="headerlink" title="数据操作"></a>数据操作</h2><p>和MySQL差不多</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</code></pre></td>
<td class="code"><pre><code>-- 创建OA系统的表空间
create tablespace oaspace
datafile &#39;D:\gezhongGJ\oracle\space\oa.dbf&#39;
size 10M;

<p>–创建用户，来管理表空间<br>create user wangwu identified by 123456 default tablespace oaspace;</p>
<p>–dab<br>–分配权限&#x2F;角色 用角色管理权限<br>grant connect,resource to wangwu</p>
<p>–撤销权限&#x2F;角色<br>revoke resource from wangwu<br>–以上语句的执行需要sys用户</p>
<p>–创建表需要切换用户，用户使用的是自己的空间；使用哪个用户登录，表就创建在哪个用户的表空间中<br>–创建用户表<br>–如果表名或列名是数据库的关键字，在关键字两旁使用<code>id</code><br>create table oa_users(<br>       user_id integer primary key,<br>       user_name varchar2(30) not null,<br>       age integer not null<br>);</p>
<p>–check 约束<br>alter table oa_users<br>add constraints CK_AGE check(age between 18 and 65);</p>
<p>–插入数据<br>insert into oa_users values(1001,&#39;王五&#39;,17);</p>
<p>– 查询<br>select * from oa_users;</p>
<p>– 创建学生表<br>create table students(<br>       stuno char(10) primary key,<br>       stuname varchar2(30) not null,<br>       joindate date not null<br>);<br>insert into students values(&#39;jsj1001&#39;,&#39;张三&#39;,&#39;29-10月-2019&#39;);<br>–利用时间函数<br>insert into students values(&#39;jsj1002&#39;,&#39;李四&#39;,sysdate);<br>select * from students</p>
<p>–插入的数据通过查询得到<br>–复制一个表 scott<br>create table mydept as<br>select * from dept where 1 &#x3D; 2</p>
<p>insert into mydept<br>select * from dept where deptno&#x3D;10;</p>
<p>insert into mydept<br>select 20,dname,loc from dept;</p>
<p>select * from mydept for update</p>
<p>– 更新子查询<br>update mydept set (dname,loc)&#x3D;(select dname,loc from mydept where deptno &#x3D; 10) where deptno &#x3D; 11</p>
<p>–连接符操作，列的合并 &#39;-&#39;拼接<br>select dname ||&#39;-&#39;||loc from mydept</p>
<p>–从员工表中查询所在的部门编号<br>–消除重复行的数据<br>select dname from dept where deptno in (select distinct deptno from emp )<br>select emp1.deptno,dept.dname from (select distinct deptno from emp) emp1,dept where dept.deptno &#x3D; emp1.deptno</p>
<p>–简单子查询 &gt;&#x3D; &gt; &lt; &lt;&#x3D; &#x3D; !&#x3D;<br>–复杂子查询<br>–批量删除 sql<br>–把要删除的主键值存入数组，集合<br>delete from mydept where deptno in (10,20);</p>
<p>–查询各个部门的员工信息<br>–子查询<br>select * from emp where sal &gt; (select sal from emp where ename &#x3D; &#39;SCOTT&#39;)</p>
<p>–联合查询 把多条select的查询结果整合到一个查询结果中<br>–条件:1.列的数量相同<br>–     2.列的类型和长度要对应<br>select deptno,dname from dept union all select deptno,dname from mydept</p>
<p>select deptno,dname from dept union  select deptno,dname from mydept</p>
<p>–创建视图<br>create view view_emps as select ename,job,dname from emp inner join dept on emp.deptno &#x3D; dept.deptno;<br>select * from view_emps</code></pre></td></p>
</tr>
</tbody>
</table>
</figure>

<h2 id="与Java连接"><a href="#与Java连接" class="headerlink" title="与Java连接"></a>与Java连接</h2><p>与MySQL的区别：</p>
<ol>
<li><p>jar包</p>
</li>
<li><p>驱动名:oracle.jdbc.driver.OracleDriver</p>
</li>
<li><p>url</p>
</li>
</ol>
<h3 id="序列"><a href="#序列" class="headerlink" title="序列"></a>序列</h3><ul>
<li>自动产生唯一数值</li>
<li>是一个可共享的对象</li>
<li>用于主键值的创建</li>
<li>当序列驻留在缓存中时，可以有效地提高序列的访问效率</li>
<li>序列数值的产生及存储与表无关</li>
</ul>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</code></pre></td>
<td class="code"><pre><code>--序列的使用
--1.创建表
create table t1(
tid number(5,0) primary key,
tname varchar2(30) not null
);
create table t2(
tid number(5,0) primary key,
tname varchar2(30) not null
);
--创建序列
create sequence seq_id 
start with 10 --从10开始
increment by 2  --自增2
nomaxvalue   --没有最大值限制
nocycle   --不循环产生
cache 10;  --缓存10个

<p>insert into t1 values(seq_id.nextval,&#39;aaa&#39;);<br>insert into t2 values(seq_id.nextval,&#39;bbb&#39;);</p>
<p>select * from t1;<br>select * from t2;</p>
<p>select seq_id.currval from dual; –最近产生的最后一个序列值，dual存放值<br>select * from user_sequences;    –查看所有序列的详细情况，sequences存放序列信息</code></pre></td></p>
</tr>
</tbody>
</table>
</figure>

<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><blockquote>
<p>帮助数据库快速查询数据，相当于目录</p>
</blockquote>
<p>当在表中创建主键(PRIMARY<br>KEY)\唯一键(UNIQUE)后，会自动创建主键索引\唯一键索引</p>
<h3 id="创建索引的原则"><a href="#创建索引的原则" class="headerlink" title="创建索引的原则"></a>创建索引的原则</h3><ul>
<li>经常用于where子句或作为连接条件的列</li>
<li>所含数据值范围比较大的列</li>
<li>含有大量空值的列</li>
<li>表比较大，但大部分查询返回的结果集小于其总记录的2%-4%</li>
<li>频繁更新的表不建议用索引</li>
</ul>
<h3 id="索引的分类"><a href="#索引的分类" class="headerlink" title="索引的分类"></a>索引的分类</h3><ul>
<li>从创建的角度：<ul>
<li>自动索引</li>
<li>手动索引</li>
</ul>
</li>
<li>从索引的存储结构：<ul>
<li>B-Tree索引</li>
<li>Hash索引</li>
</ul>
</li>
</ul>
<h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><ul>
<li>堆栈</li>
<li>队列</li>
<li>二叉树</li>
<li>平衡二叉树<ul>
<li>左右子树高度差的绝对值不能超过1，且左右子树都是平衡二叉树</li>
</ul>
</li>
<li>B-树</li>
</ul>
<h2 id="PL-SQL编程"><a href="#PL-SQL编程" class="headerlink" title="PL&#x2F;SQL编程"></a>PL&#x2F;SQL编程</h2><ul>
<li><p>基本语法</p>
<p>BEGIN</p>
<p>EXCEPTION</p>
<p>LOOP</p>
<p>END</p>
</li>
<li><p>常量，变量</p>
<ul>
<li>声明变量：</li>
<li>声明常量：</li>
</ul>
</li>
</ul>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17</code></pre></td>
<td class="code"><pre><code>--PL-SQL编程
declare
  v_name varchar2(30);
  --声明变量的数据类型和表中的某个列的类型一致
  V_job emp.job%type; 
begin
  -- 给变量赋值
  v_name:=&#39;王五&#39;;
--通过select给变量赋值，要保证查询结果的唯一性：添加查询条件
  select ename into v_name from emp where empno = 7788;
  select job into v_job from emp where empno = 7788;
    --合并编写
  select ename,job into v_name,v_job from emp where empno=7788;
  --输出变量的值
  dbms_output.put_line(v_name);
  dbms_output.put_line(&#39;job:&#39;||&#39;--------------------------------&#39;||v_job);
end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>

<ol>
<li><p>sysdate 赋值当前时间</p>
</li>
<li><p>val</p>
</li>
<li><p>NVL(sal,0) 如果sal列为null，用0替代</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1</code></pre></td>
<td class="code"><pre><code>select sal,job,nvl(comm,0)+sal as totalsal from emp;</code></pre></td>
</tr>
</tbody>
</table>
</figure>
</li>
<li><p>decode(列名,值1,执行1,值2,执行2,…..)</p>
<p>相当于多个if</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1</code></pre></td>
<td class="code"><pre><code>select ename,sal,decode(job,&#39;SALESMAN&#39;,&#39;销售人员&#39;,&#39;CLERK&#39;,&#39;文职&#39;) from emp;</code></pre></td>
</tr>
</tbody>
</table>
</figure>
</li>
<li><p>&amp;：输入</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12</code></pre></td>
<td class="code"><pre><code>-- PL/SQL输入部门
declare
  v_dno dept.deptno%type;
  v_dname dept.dname%type;
  v_loc dept.loc%type;
begin
  -- 变量赋值为输入的值，&amp;后面的名字随意
  v_dno:=&amp;dno;
  v_dname:=&#39;&amp;dname&#39;; --字符串，日期类型需要加引号
  v_loc:=&#39;&amp;dloc&#39;;
  insert into dept values(v_dno,v_dname,v_loc);
end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>
</li>
<li><p>if</p>
<p>if…then…;</p>
<p>​ else…;</p>
<p>end if</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</code></pre></td>
<td class="code"><pre><code>--输入员工编号和目前薪资，判断
--如果薪资&lt;2500，加薪1000；否则加薪500；
declare 
  v_empno emp.empno%type;
  v_sal emp.sal%type;
begin
  v_empno:=&amp;eno;
  v_sal:=&amp;sal;
  if v_sal&lt;2500
    then 
      update emp set sal = sal+1000 where empno = v_empno;
    else
      update emp set sal = sal + 500 where empno = v_empno;
  end if;
end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>
</li>
<li><p>case 基本不用</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12</code></pre></td>
<td class="code"><pre><code>--case when-then
declare 
  v_empno emp.empno%type;
  v_sal emp.sal%type;
begin
  v_empno:=&amp;eno;
  v_sal:=&amp;sal;
       case
       when v_sal &lt; 2500 then update emp set sal = sal+1000 where empno = v_empno;
       when v_sal &gt; 2500 then update emp set sal = sal + 500 where empno = v_empno;
       end case;
     end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>
</li>
<li><p>loop</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11</code></pre></td>
<td class="code"><pre><code>--loop循环
declare
  v_age number(3,0):=1;
  begin
    loop
      if v_age&gt;=18 then exit;
      end if;
      v_age:=v_age+1;
    end loop;
    dbms_output.put_line(&#39;v_age=&#39;||v_age);
  end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>
</li>
<li><p>while</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11</code></pre></td>
<td class="code"><pre><code>--while
declare
v_num number(3,0):=1;
v_sum number(6,0):=0;
begin
  while v_num &lt;=100 loop
    v_sum := v_sum+v_num;
    v_num := v_num+1;
    end loop;
    dbms_output.put_line(&#39;v_sum=&#39;||v_sum);
end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>
</li>
<li><p>for</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9</code></pre></td>
<td class="code"><pre><code>--for
declare
v_num number(4,0):=0;
begin
  for i in 1..100 loop
    v_num:=v_num+i;
  end loop;
  dbms_output.put_line(&#39;v_num=&#39;||v_num);
end;</code></pre></td>
</tr>
</tbody>
</table>
</figure></li>
</ol>
<h4 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h4><blockquote>
<p>存储过程和函数以命名的数据库对象形式存储于数据库中</p>
</blockquote>
<ul>
<li>创建存储过程</li>
</ul>
<blockquote>
<p>当定义存储过程的参数时，只能指定数据类型，不能指定数据长度</p>
</blockquote>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14</code></pre></td>
<td class="code"><pre><code>--计算部门员工个数的存储过程：参数 部门编号
create or replace procedure pro_countemp(dno emp.deptno%type)
is 
begin
  declare v_count number(3,0);
  begin
    select count(empno) into v_count from emp where deptno = dno;
    dbms_output.put_line(v_count);
  end;
end pro_countemp; --end后面的名字加不加都行
--调用存储过程
begin
  pro_countemp(10);
end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>

<p>输入输出参数：</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20</code></pre></td>
<td class="code"><pre><code>--存储过程：完成业务功能处理，不能返回值
--存储过程的参数类型：in 输入参数--向存储过程内传递值
--                      out 输出参数--得到存储过程里的值
create or replace procedure pro_countemp2(dno in emp.deptno%type,empcount out number)
is 
begin
  declare v_count number(3,0);
  begin
    select count(empno) into v_count from emp where deptno = dno;
    dbms_output.put_line(v_count);
    empcount:=v_count;
  end;
end pro_countemp2;
--调用存储过程
declare v_count number(3,0):=0;
begin
  pro_countemp2(10,v_count);
  --输出v_count的值
  dbms_output.put_line(v_count);
end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>

<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19</code></pre></td>
<td class="code"><pre><code>--申明函数
create or replace function fun_countemp(dno emp.deptno%type)
return number
is
begin
  declare v_count number(3,0):=0;
  begin
          select count(empno) into v_count from emp where deptno = dno;
   return v_count;
   end;
end;
--调用函数
--声明接收返回值的变量
declare
  v_empCount number(3,0):=0;
  begin
    v_empCount:=fun_countemp(10);
    dbms_output.put_line(v_empCount);
  end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>

<h2 id="常见的数据库系统函数"><a href="#常见的数据库系统函数" class="headerlink" title="常见的数据库系统函数"></a>常见的数据库系统函数</h2><p>1.全局变量</p>
<p>@@DATEFIRST:返回当前设置的一周的第一天<br>@@ERROR:返回当前连接中最后执行sql语句的错误代码<br>@@IDENTITY:返回当前连接中作为最后一条insert或者select into<br>语句的结果插入的标识值（最后插入的标识值）<br>@@OPTIONS:返回通过使用set命令设置的选择的信息<br>@@REMSERVER:仅在存储过程中使用，返回调用存储过程的服务器的值<br>@@ROWCOUNT:返回最后一条语句所影响的行数<br>@@SERVERNAME:返回正在运行脚本的本地服务器的名称<br>@@TRANCOUNT:返回当前连接的活动事务数（实质是事务嵌套级别）<br>@@VERSION:返回当前的SQL SERVER安装版本以及日期，处理器和O&#x2F;S体系结构</p>
<p>SCOPE_IDENTITY()类似@IDENTITY，但返回在当前会话和作用域中插入的最后一个标识，<br>SCOPE_IDENTITY() 只返回插入到当前作用域中的值；@@IDENTITY<br>不受限于特定的作用域。</p>
<p>2.检索错误的系统函数<br>ERROR_NUMBER():实际错误号，若在存储过程里，只在catch块中有效<br>ERROR_SEVERITY():错误级别<br>ERROR_STATE():位置标记<br>ERROR_PROCEDURE():使用不多因为他只与存储过程，函数和触发器相关。这提供了导致错误的存储过程的名称<br>ERROR_LINE():错误所在的行号<br>ERROR_MESSAGE():消息文本</p>
<p>3.日期和时间函数<br>（表示所需取的时段：原词-缩写（year-yy，month-mm,day-dd,hour-hh,minute-mi,second-ss）<br>）<br>datepart(hh,日期字段)獲取這個字段的小時<br>dateadd(yy,4,日期字段)将这个字段往后加四年（日期&#x2F;时间值上加上日期单位间隔）可以增加需要處理的任意長的時間<br>eg:dateadd(yy,4,’2018-4-4’)—-结果是：2022-4-4 00:00:00:0000<br>datediff(month,日期字段1，日期字段2)返回两个时间之间的差值<br>eg:datediff(month,’2018-8-8’,’2018-12.9’)—结果是：4个月<br>getdate():返回当前日期时间</p>
<h3 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h3><blockquote>
<p>游标是数据段的一个内存空间，存放select查询结果，可以对游标中的数据进行提取使用</p>
</blockquote>
<p>分类：</p>
<ol>
<li><p>显示游标：</p>
<p>声明游标： 把select的结果存入对应的内存空间中</p>
<p>打开游标：<br>提取游标：提取游标中的数据<br>关闭游标：2、隐式游标：系统自带游标</p>
</li>
</ol>
<p>使用方式1：</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15</code></pre></td>
<td class="code"><pre><code>--声明游标
declare
  cursor cur_emp is select * from emp where deptno=30;
  --声明 cur_emp游标类型的一个变量
  c cur_emp%rowtype;
  --存放总薪资
  v_sum emp.sal%type:=0;
begin
--for遍历提取游标中的数据
--在循环中自动打开关闭游标
  for c in cur_emp loop
    dbms_output.put_line(c.empno||&#39;=====&#39;||c.ename);
  end loop;
  dbms_output.put_line(&#39;30部门的总薪资是:&#39;||v_sum);
end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>

<p>使用方式2：</p>
<figure class="highlight sql">
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td class="gutter"><pre><code>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18</code></pre></td>
<td class="code"><pre><code>declare
  cursor cur_emp2 is select * from emp where deptno=30;
  c cur_emp2%rowtype;
  v_sum emp.sal%type;
begin
--打开游标
  open cur_emp2;
  loop
  --提取游标中的数据，每次提取一行
  fetch cur_emp2 into c;
  --循环结束条件
  exit when cur_emp2%notfound;
  v_sum:=v_sum+c.sal;
  end loop;
  --关闭游标
  close cur_emp2;
  dbms_output.put_line(&#39;30部门的总薪资是:&#39;||v_sum);
end;</code></pre></td>
</tr>
</tbody>
</table>
</figure>

<ul>
<li>游标的属性：</li>
</ul>
<p>%notfound:fetch是否提取到数据,没有true;提取到false;</p>
<p>%found:与notfound相反</p>
<p>%rowcount:</p>
<p>%isopen:布尔值，游标是否已经打开</p>
<ul>
<li><p>动态游标</p>
</li>
<li><p>游标参数</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fbread.github.io/2019/10/29/20191029_oracle%E6%95%B0%E6%8D%AE%E5%BA%93/" data-id="clwsymwff001rdggb9tiv5cic" data-title="oracle数据库" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/10/29/20191029_%E7%BA%A2%E9%BB%91%E6%A0%91/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          红黑树
        
      </div>
    </a>
  
  
    <a href="/2019/10/28/20191028_jvm/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">jvm</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hibernate/" rel="tag">Hibernate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Idea/" rel="tag">Idea</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postgres/" rel="tag">Postgres</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Quartz/" rel="tag">Quartz</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Thymeleaf/" rel="tag">Thymeleaf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cookie/" rel="tag">cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/" rel="tag">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/session/" rel="tag">session</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" rel="tag">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Hibernate/" style="font-size: 10px;">Hibernate</a> <a href="/tags/Idea/" style="font-size: 10px;">Idea</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/tags/Postgres/" style="font-size: 10px;">Postgres</a> <a href="/tags/Quartz/" style="font-size: 10px;">Quartz</a> <a href="/tags/Thymeleaf/" style="font-size: 10px;">Thymeleaf</a> <a href="/tags/cookie/" style="font-size: 10px;">cookie</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/session/" style="font-size: 10px;">session</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 15px;">数据结构</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 10px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/05/30/20240530-thymeleaf-1/">thymeleaf-1</a>
          </li>
        
          <li>
            <a href="/2024/05/29/20240529_Postgres%E5%AE%9E%E7%8E%B0on%20update%20current_timestamp/">Postgres实现on update current_timestamp</a>
          </li>
        
          <li>
            <a href="/2024/05/28/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/10/31/20191031_hibernate-1/">Hibernate-1</a>
          </li>
        
          <li>
            <a href="/2019/10/31/20191031_%E4%BA%8C%E5%8F%89%E6%A0%91/">二叉树</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Ziyi Jiang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>